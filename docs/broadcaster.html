<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Broadcaster</title>
  <script src="https://cdn.jsdelivr.net/npm/peerjs@1.4.7/dist/peerjs.min.js"></script>
</head>
<body>
  <h1>Broadcaster</h1>
  <p>Status: <span id="status">Initializing...</span></p>
  <button id="addScreenBtn">Add Screen</button>
  <div id="screensContainer"></div>

  <script>
    const status = msg => document.getElementById('status').textContent = msg;
    const container = document.getElementById('screensContainer');

    async function addScreen() {
      const newPeer = new Peer({
        host: 'my-peerjs-server-thefiringflam-121a8798e654.herokuapp.com',
        port: 443,
        secure: true,
        config: { iceServers: [] },
        debug: 2
      });

      newPeer.on('open', async id => {
        const stream = await navigator.mediaDevices.getDisplayMedia({
          video: { width: 1280, height: 720, frameRate: 30 },
          audio: true
        });

        status(`Streaming screen with ID: ${id}`);
        const display = document.createElement('p');
        display.innerHTML = `Screen ID: <b>${id}</b>`;
        container.appendChild(display);

        newPeer.on('call', call => {
          call.answer(stream);
          call.on('error', err => console.error('Call error:', err));
          call.on('close', () => console.log('Call closed for screen ID:', id));
        });
      });

      newPeer.on('error', err => console.error('Peer error:', err));
    }

    document.getElementById('addScreenBtn').addEventListener('click', addScreen);
  </script>
</body>
</html>
